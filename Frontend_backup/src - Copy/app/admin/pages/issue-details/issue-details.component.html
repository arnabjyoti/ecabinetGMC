<div class="main-content container py-4">
  <!-- ISSUE INFORMATION -->
  <div class="ccard sshadow-sm ssection-card">
    <div class="ccard-body">
      <div class="row mb-2">
        <div class="col-md-4"><strong>Issue ID:</strong> {{ issue?.id }}</div>
        <div class="col-md-4"><strong>Ward No:</strong> {{ issue?.ward }}</div>
        <div class="col-md-4">
          <strong>Location:</strong> {{ issue.location }}
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-md-4">
          <strong>Department:</strong> {{ issue?.department }}
        </div>
        <div class="col-md-4">
          <strong>Raised By:</strong> {{ activeTab == 'draft' || activeTab == 'sent' ? 'Myself' : issue.raisedBy }}
        </div>
        <div class="col-md-4">
          <strong>Submission Date:</strong> {{ issue.branchActionDate }}
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-md-12">
          <p class="mb-2">
            <strong>Description:</strong> {{ issue.description }}
          </p>
        </div>
      </div>
      <!-- ATTACHMENTS -->
      <div class="ccard sshadow-sm ssection-card" style="min-height: 20vh">
        <div class="ccard-body">
          <h5 class="fw-bold mb-3">
            Attachments
            <button
              class="btn"
              style="background-color: aliceblue; color: gray"
            >
              <i class="bi bi-paperclip me-1"></i> Attach File
            </button>
          </h5>

          <div class="row g-4 mb-5"
            *ngIf="issue.attachments?.length; else noAttachments"
          >
            <div class="col-md-3" *ngFor="let a of issue.attachments">
              <div class="attachment-card text-center p-3">
                <i class="bi bi-file-earmark-text attachment-icon"></i>
                <p class="fw-semibold mt-2">{{ a.name }}</p>

                <a [href]="a.src" download class="btn btn-primary btn-sm w-100">
                 <i class="bi bi-download"></i> Download
                </a>
              </div>
            </div>
          </div>
          <ng-template #noAttachments>
            <div style="color: rgb(186, 184, 184); font-weight: bold">
              No attachments found
            </div>
          </ng-template>
        </div>
      </div>

      <div *ngIf="activeTab != 'draft'" class="row">
        <div class="col-md-12">
          <div class="row mb-2">
            <div class="col-md-4">
              <strong>Forwarded to Municipal Secretary:</strong>
              {{ issue?.branchAction == "Sent" ? "Yes" : "No" }} 
            </div>
            <div class="col-md-1">
              <i class="bi bi-arrow-right"></i>
            </div>
            <div class="col-md-3">
              <strong>Approval Status:</strong> {{ issue?.municipalAction == "Approved" ? "Approved" : issue?.municipalAction == "Rejected" ? "Rejected" : "Pending" }}
            </div>
            <div class="col-md-1">
              <i class="bi bi-arrow-right"></i>
            </div>
            <div class="col-md-3"><strong>Date:</strong> {{ issue?.municipalActionDate ? issue?.municipalActionDate : "NA" }}</div>
          </div>
          <div class="row mb-2">
            <div class="col-md-4">
              <strong>Forwarded to Commissioner:</strong>
              {{ issue?.municipalAction == "Approved" ? "Yes" : "No" }}
            </div>
            <div class="col-md-1">
              <i class="bi bi-arrow-right"></i>
            </div>
            <div class="col-md-3">
              <strong>Approval Status:</strong> {{ issue?.commissionerAction == "Approved" ? "Approved" : issue?.commissionerAction == "Rejected" ? "Rejected" : "Pending" }}
            </div>
            <div class="col-md-1">
              <i class="bi bi-arrow-right"></i>
            </div>
            <div class="col-md-3"><strong>Date:</strong> {{ issue?.commissionerActionDate ? issue?.commissionerActionDate : "NA" }}</div>
          </div>
          <div class="row mb-2">
            <div class="col-md-4">
              <strong>Approved for MIC Meeting:</strong>
              {{ issue?.commissionerAction == "Approved" ? "Yes" : "No" }}
            </div>
             <div class="col-md-1">
              <i class="bi bi-arrow-right"></i>
            </div>
            <div class="col-md-3">
              <strong>Voting Status:</strong> {{ issue?.voting ? issue?.voting : "Pending" }}
            </div>
             <div class="col-md-1">
              <i class="bi bi-arrow-right"></i>
            </div>
            <div class="col-md-3"><strong>Date:</strong> {{ issue?.votingDate ? issue?.votingDate : "NA" }}</div>
          </div>
          <div class="row mb-2">
            <div class="col-md-12">
              <p class="mt-3">
                <strong>Final Acceptance Status:&nbsp;</strong>
                <span
                  class="badge status-badge text-white bg-{{
                    issue.status == 'Pending'
                      ? 'warning'
                      : issue.status == 'Accepted'
                      ? 'success'
                      : 'danger'
                  }}"
                >
                  {{ issue.status }}
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WORKFLOW TIMELINE -->
  <!-- <div class="ccard sshadow-sm ssection-card">
    <div class="ccard-body">
      <h5 class="fw-bold mb-3">Workflow Status Timeline</h5>

      <div class="timeline-container">
        <div class="timeline-line"></div>

        <div *ngFor="let t of issue.timeline" class="timeline-item">
          <div class="timeline-dot"></div>
          <div>
            <p class="timeline-step mb-0">{{ t.step }}</p>
            <small class="text-muted">{{ t.date }}</small>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <!-- COMMENTS -->
  <div *ngIf="activeTab != 'draft'" class="ccard sshadow-sm ssection-card mb-5">
    <div class="ccard-body">
      <h5 class="fw-bold mb-3"><i class="bi bi-chat me-1"></i> Comments</h5>

      <!-- <textarea
        [(ngModel)]="remarks"
        rows="4"
        class="form-control mb-3"
        placeholder="Add your remarks here..."
      ></textarea> -->

      <!-- <div>
        <h5 class="fw-bold mb-3">Status</h5>
        <select name="" [(ngModel)]="status" class="form-control" id="">
          <option value="">-select-</option>
          <option value="Accepted">Accepted</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div> -->

      <div class="comment-box">
        <!-- <img src="assets/user-avatar.png" class="avatar" alt="User" /> -->

        <div class="input-wrapper">
          <input
            type="text"
            class="comment-input"
            placeholder="Write a comment..."
            [(ngModel)]="commentText"
            (keyup.enter)="sendComment()"
          />

          <button
            class="send-btn"
            [disabled]="!commentText?.trim()"
            (click)="sendComment()"
          >
            <i class="bi bi-send-fill"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  <br />

  <button
    *ngIf="activeTab == 'draft'"
    class="btn btn-primary px-4"
    (click)="confirmMe()"
    style="float: right"
  >
    <i class="bi bi-send"></i> Send
  </button>
</div>


<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="ball-spin-clockwise"
  style="background-color: aliceblue"
>
  <p style="color: white">
    <i
      class="fa fa-circle-o-notch fa-spin fa-4x text-danger"
      aria-hidden="true"
    ></i
    >Loading...Please Wait
  </p>
</ngx-spinner>
