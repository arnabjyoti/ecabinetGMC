<app-sidebar></app-sidebar>

<div class="main-content container py-4" *ngIf="issue">
  <h3 class="page-title">Issue Details</h3>

  <!-- ISSUE INFORMATION -->
  <div class="card shadow-sm section-card">
    <div class="card-body">
      <h4 class="fw-bold mb-3">Issue Title: {{ issue.title }}</h4>

      <div class="row mb-2">
        <div class="col-md-4"><strong>Issue ID:</strong> {{ issue.id }}</div>
        <div class="col-md-4"><strong>Ward No:</strong> {{ issue.ward }}</div>
        <div class="col-md-4">
          <strong>Submitted By:</strong> {{ issue.submittedBy }}
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-md-4">
          <strong>Date Submitted:</strong> {{ issue.date }}
        </div>
        <div class="col-md-8">
          <strong>Location:</strong> {{ issue.location }}
        </div>
      </div>

      <p class="mb-2"><strong>Description:</strong> {{ issue.description }}</p>

      <!-- <p class="mt-3" *ngFor="let s of issue.status">
        <strong>Current Status:</strong>
        <span class="badge status-badge text-white bg-{{ s.status == 'In-Process' ? 'warning' : s.status == 'Accepted' ? 'success' : 'danger' }}">
          {{ s.status }}
        </span>
      </p> -->
      <p class="mt-3">
        <strong>Current Status:</strong>
        <span class="badge status-badge text-white bg-{{ currentStatus == 'In-Process' ? 'warning' : currentStatus == 'Accepted' ? 'success' : 'danger' }}">
          {{ currentStatus }}
        </span>
      </p>
    </div>
  </div>

  <!-- WORKFLOW TIMELINE -->
  <div class="card shadow-sm section-card">
    <div class="card-body">
      <h5 class="fw-bold mb-3">Workflow Status Timeline</h5>

      <div class="timeline-container">
        <div class="timeline-line"></div>

        <div *ngFor="let t of issue.timeline" class="timeline-item">
          <div class="timeline-dot"></div>
          <div>
            <p class="timeline-step mb-0">{{ t.step }}</p>
            <small class="text-muted">{{ t.date }}</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ATTACHMENTS -->
  <div class="card shadow-sm section-card">
    <div class="card-body">
      <h5 class="fw-bold mb-3">Attachments</h5>

      <div class="row g-4">
        <div class="col-md-3" *ngFor="let a of issue.attachments">
          <div class="attachment-card text-center p-3">
            <i class="bi bi-file-earmark-text attachment-icon"></i>
            <p class="fw-semibold mt-2">{{ a.name }}</p>

            <a [href]="a.src" download class="btn btn-primary btn-sm w-100">
              Download
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- COMMENTS -->
  <div class="card shadow-sm section-card mb-5">
    <div class="card-body">
      <h5 class="fw-bold mb-3">Remarks / Comments</h5>

      <textarea
      [(ngModel)]="remarks"
        rows="4"
        class="form-control mb-3"
        placeholder="Add your remarks here..."
      ></textarea>

      <div>
        <h5 class="fw-bold mb-3">Status</h5>
        <select name="" [(ngModel)]="status" class="form-control" id="">
          <option value="">-select-</option>
          <option value="Accepted">Accepted</option>
          <option value="Rejected">Rejected</option>
        </select>
      </div>
      <br/>

      <button class="btn btn-primary px-4"(click)="submitIssue()">Submit</button>
    </div>
  </div>
</div>
